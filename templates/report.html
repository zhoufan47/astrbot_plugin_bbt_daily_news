<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ¯æ—¥ç®€æŠ¥</title>
    <style>
        body { font-family: 'Source Han Sans', sans-serif; background-color: #f0f2f5; padding: 20px; width: 600px; }
        .container { background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .header h1 { margin: 0; font-size: 24px; }
        .header p { margin: 5px 0 0; opacity: 0.8; font-size: 14px; }
        
        .section { padding: 15px 20px; border-bottom: 1px solid #eee; }
        .section-title { font-weight: bold; color: #333; margin-bottom: 10px; display: flex; align-items: center; }
        .section-title::before { content: ''; display: inline-block; width: 4px; height: 16px; background: #764ba2; margin-right: 8px; border-radius: 2px; }
        
        ul { padding-left: 20px; margin: 0; }
        li { margin-bottom: 5px; color: #555; font-size: 14px; }
        
        .tag { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-right: 5px; }
        .price-up { color: #d9534f; }
        .price-down { color: #5cb85c; }
        
        .footer { text-align: center; padding: 10px; color: #999; font-size: 12px; background: #fafafa; }
        .anime-grid {
            display: grid;
            /* 3åˆ—å¸ƒå±€ï¼Œè‡ªåŠ¨å¡«æ»¡ */
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        .anime-cover-box {
            width: 100%;
            /* å¼ºåˆ¶è®¾å®šå®½é«˜æ¯”ï¼Œè¿™é‡Œä½¿ç”¨ 2:3 (ç”µå½±æµ·æŠ¥æ ‡å‡†æ¯”ä¾‹) */
            /* å¦‚æœè§‰å¾—å¤ªé•¿ï¼Œå¯ä»¥æ”¹ä¸º 3:4 */
            aspect-ratio: 2 / 3;
            background-color: #eee;
            position: relative;
            overflow: hidden; /* é˜²æ­¢å›¾ç‰‡æº¢å‡ºåœ†è§’ */
        }
        .anime-cover-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center top;
            display: block;
        }
        .anime-card {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            text-align: center;
            height: 100%; /* æ’‘æ»¡ Grid å•å…ƒæ ¼ */
        }
        .anime-title {
            padding: 8px;
            font-size: 12px;
            color: #333;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }
        .jav-grid {
            display: grid;
            /* 3åˆ—å¸ƒå±€ï¼Œè‡ªåŠ¨å¡«æ»¡ */
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        .jav-card {
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            text-align: center;
        }
        .jav-cover-box {
            width: 100%;
            /* ä¿æŒå°é¢æ¯”ä¾‹ï¼Œä¾‹å¦‚ 3:4 */
            aspect-ratio: 3 / 4;
            background-color: #eee;
            position: relative;
        }
        .jav-cover-box img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* è£å‰ªå¡«å……ï¼Œä¿è¯æ•´é½ */
            display: block;
        }
        .jav-title {
            padding: 8px;
            font-size: 12px;
            color: #333;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }
		/* --- æ–°å¢ï¼šåŒæ å¹¶æ’å¸ƒå±€æ ·å¼ --- */
        .row-container {
            display: flex;
            gap: 20px; /* ä¸¤ä¸ªåˆ—è¡¨ä¹‹é—´çš„é—´è· */
        }
        .col-half {
            flex: 1; /* å„å  50% */
            min-width: 0; /* å…³é”®ï¼šé˜²æ­¢ flex å­å…ƒç´ è¢«é•¿æ–‡æœ¬æ’‘å¤§ */
        }
        /* å¹¶æ’æ¨¡å¼ä¸‹ï¼Œåˆ—è¡¨æ–‡å­—å¦‚æœå¤ªé•¿ï¼Œæ˜¾ç¤ºçœç•¥å·ï¼Œä¿æŒæ•´é½ */
        .col-half ul li {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* ç”µå½±å¡ç‰‡ç‰¹æœ‰æ ·å¼ */
        .movie-date {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .movie-type {
            font-size: 10px;
            color: #999;
            margin-top: -5px;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 5px;
        }
        /* æ¸¸æˆå¹³å°æ ‡ç­¾æ ·å¼ */
        .game-platforms {
            font-size: 10px;
            color: #fff;
            background-color: #764ba2; /* ç´«è‰²èƒŒæ™¯ï¼Œå¥‘åˆæ¸¸æˆæ°›å›´ */
            padding: 2px 0;
            margin-top: -2px; /* ç´§è´´å›¾ç‰‡ä¸‹æ–¹ */
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* è°ƒæ•´ä¸€ä¸‹æ ‡é¢˜ï¼Œé˜²æ­¢è¢«æŒ¤å‹ */
        .game-card .anime-title {
            padding-top: 4px;
            height: 30px; /* ç¨å¾®è°ƒå°ä¸€ç‚¹ç»™å¹³å°è…¾ä½ç½® */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ£’æ£’ç³–çš„æ¯æ—¥æ—©æŠ¥</h1>
            <p>{{ date }}</p>
        </div>
        {% if exchange_rates.error %}
        {% else %}
        <div class="section" style="background: #fff8e1; border-color: #ffe082;">
            <div class="section-title" style="color: #f57f17;">
                <span style="margin-right: 5px;">ğŸ’°</span> æ±‡ç‡é€Ÿé€’ (1 äººæ°‘å¸ å…‘æ¢)
            </div>

                <div style="color: #d32f2f; font-size: 13px;">{{ exchange_rates.error }}</div>

                <div style="display: flex; justify-content: space-between; text-align: center; font-size: 14px;">
                    <div>
                        <div style="font-size: 20px;">ğŸ‡ºğŸ‡¸</div>
                        <div style="font-weight: bold; color: #333;">{{ exchange_rates.USD }}</div>
                        <div style="font-size: 12px; color: #888;">ç¾å…ƒ</div>
                    </div>
                    <div>
                        <div style="font-size: 20px;">ğŸ‡¯ğŸ‡µ</div>
                        <div style="font-weight: bold; color: #333;">{{ exchange_rates.JPY }}</div>
                        <div style="font-size: 12px; color: #888;">æ—¥å…ƒ</div>
                    </div>
                    <div>
                        <div style="font-size: 20px;">ğŸ‡¨ğŸ‡³</div>
                        <div style="font-weight: bold; color: #333;">{{ exchange_rates.TWD }}</div>
                        <div style="font-size: 12px; color: #888;">æ–°å°å¸</div>
                    </div>
                    <div>
                        <div style="font-size: 20px;">ğŸ‡­ğŸ‡°</div>
                        <div style="font-weight: bold; color: #333;">{{ exchange_rates.HKD }}</div>
                        <div style="font-size: 12px; color: #888;">æ¸¯å¸</div>
                    </div>
                    <div>
                        <div style="font-size: 20px;">ğŸ‡ªğŸ‡º</div>
                        <div style="font-weight: bold; color: #333;">{{ exchange_rates.EUR }}</div>
                        <div style="font-size: 12px; color: #888;">æ¬§å…ƒ</div>
                    </div>
                    <div>
                        <div style="font-size: 20px;">ğŸ‡¬ğŸ‡§</div>
                        <div style="font-weight: bold; color: #333;">{{ exchange_rates.GBP }}</div>
                        <div style="font-size: 12px; color: #888;">è‹±é•‘</div>
                    </div>
                </div>

        </div>
        {% endif %}
        <div class="section">
            <div class="section-title">æ–°é—»é€Ÿè¯»</div>
            <ul>
                {% for news in news_60s %}
                <li>{{ news }}</li>
                {% endfor %}
            </ul>
        </div>

		<div class="section">
            <div class="row-container">
                {% if weibo_hot %}
                <div class="api-card" style="background: #f8f9fa; padding: 10px; border-radius: 4px;">
                    <div class="col-half">
                        <div class="section-title">å¾®åšçƒ­æ¦œ</div>
                        <ul>
                            {% for news in weibo_hot %}
                            <li>{{ news }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% if toutiao_hot %}
                {% endif %}
                <div class="api-card" style="background: #f8f9fa; padding: 10px; border-radius: 4px;">
                    <div class="col-half">
                        <div class="section-title">ä»Šæ—¥å¤´æ¡çƒ­æ¦œ</div>
                        <ul>
                            {% for news in toutiao_hot %}
                            <li>{{ news }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="section">
            <div class="section-title">ITä¹‹å®¶çƒ­æ¦œ</div>
            <ul>
                {% for item in news_ithome %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>

        <div class="section">
            <div class="section-title">AI API é¢åº¦ç›‘æ§</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                {% if not ai_balances.OpenRouter.error %}
                <div class="api-card" style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #333;">OpenRouter</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        <span>æ¯æ—¥ç”¨é‡: <b>{{ ai_balances.OpenRouter.usage_daily }}</b></span><br>
                        <span>å‰©ä½™é™é¢: <b style="color: #28a745;">{{ ai_balances.OpenRouter.limit_remaining }}</b></span>
                    </div>
                </div>
                {% endif %}
                {% if not ai_balances.DeepSeek.error %}
                <div class="api-card" style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #333;">DeepSeek</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        <span>å‰©ä½™é™é¢: <b style="color: #28a745;">{{ ai_balances.DeepSeek.balance }}</b></span>
                    </div>
                </div>
                {% endif %}
                {% if not ai_balances.MoonShot.error %}
                <div class="api-card" style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #333;">MoonShot</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        <span>å‰©ä½™é™é¢: <b style="color: #28a745;">{{ ai_balances.MoonShot.balance }}</b></span>
                    </div>
                </div>
                {% endif %}
                {% if not ai_balances.SiliconFlow.error %}
                <div class="api-card" style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #333;">SiliconFlow</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        <span>å‰©ä½™é™é¢: <b style="color: #28a745;">{{ ai_balances.SiliconFlow.balance }}</b></span>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="section">
            <div class="section-title">å›½é™… DRAM ä»·æ ¼</div>
            <table style="width: 100%; font-size: 13px; text-align: left;">
                <tr style="color: #999;"><th>äº§å“</th><th>ä»·æ ¼ï¼ˆç¾å…ƒï¼‰</th><th>æ¶¨å¹…</th></tr>
                {% for item in dram_prices %}
                <tr>
                    <td>{{ item.name }}</td>
                    <td>{{ item.price }}</td>
                    <td class="{{ 'price-up' if '+' in item.change else 'price-down' }}">{{ item.change }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% if game_list %}
        <div class="section">
            <div class="section-title">
                <span style="margin-right: 5px;">ğŸ®</span> è¿‘æœŸå‘å”®æ–°æ¸¸
            </div>

                <div class="anime-grid">
                    {% for game in game_list %}
                    <div class="anime-card game-card">
                        <div class="anime-cover-box">
                            <img src="{{ game.cover }}" onerror="this.src='https://bgm.tv/img/no_icon_subject.png'">
                            <div class="movie-date" style="background: rgba(100, 65, 165, 0.8);">{{ game.release }}</div>
                        </div>
                        <div class="game-platforms">{{ game.platforms }}</div>
                        <div class="anime-title">{{ game.title }}</div>
                    </div>
                    {% endfor %}
                </div>

        </div>
        {% endif %}
        <div class="section">
            <div class="section-title">ä»Šæ—¥æ”¾é€åŠ¨ç”»</div>
            {% if not bangumi_list %}
                <p style="color:#999; font-size:12px;">ä»Šæ—¥æ— æ›´æ–°æˆ–è·å–å¤±è´¥</p>
            {% else %}
                <div class="anime-grid">
                    {% for anime in bangumi_list %}
                    <div class="anime-card">
                        <div class="anime-cover-box">
                            <img src="{{ anime.cover }}" onerror="this.src='https://bgm.tv/img/no_icon_subject.png'">
                        </div>
                        <div class="anime-title">{{ anime.title }}</div>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        <div class="section">
            <div class="section-title">è¿‘æœŸä¸Šæ˜ ç”µå½± (è±†ç“£)</div>
            {% if not movie_list %}
                <p style="color:#999; font-size:12px;">è·å–å¤±è´¥æˆ–è¿‘æœŸæ— æ–°ç‰‡</p>
            {% else %}
                <div class="anime-grid"> {% for movie in movie_list %}
                    <div class="anime-card">
                        <div class="anime-cover-box">
                            <img src="{{ movie.cover }}" onerror="this.src='https://bgm.tv/img/no_icon_subject.png'">
                            <div class="movie-date">{{ movie.date }}</div>
                        </div>
                        <div class="anime-title">{{ movie.title }}</div>
                        <div class="movie-type">{{ movie.type }}</div>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        {% if r18_mode=='1' %}
        <div class="section">
            <div class="section-title">DMMä»Šæ—¥TOP</div>
            {% if not dmm_top_list %}
                <p style="color:#999; font-size:12px;">è·å–å¤±è´¥</p>
            {% else %}
                <div class="jav-grid">
                    {% for dmm in dmm_top_list[:9] %}
                    <div class="jav-card">
                        <div class="jav-cover-box">
                            <img src="{{ dmm.cover }}" onerror="this.src='https://bgm.tv/img/no_icon_subject.png'">
                        </div>
                        <div class="jav-title">{{ dmm.title }}</div>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
        {% endif %}
        <div class="footer">
            Developed by <b>æ£’æ£’ç³–</b> <br>
            Powered by <b>AstrBot</b> <br>
            Data Scraped From <b>DMM</b>, <b>ç•ªç»„è®¡åˆ’</b>, <b>ITä¹‹å®¶</b>, <b>DRAMX</b>,<b>è±†ç“£</b>,<b>å¾®åš</b>,<b>ä»Šæ—¥å¤´æ¡</b>
        </div>
    </div>
</body>
</html>